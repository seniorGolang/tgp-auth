# Плагины аутентификации GitHub для tg

Этот репозиторий содержит два плагина для работы с аутентификацией GitHub в системе `tg`: `login` и `auth-github`. Плагины работают совместно для обеспечения авторизованного доступа к GitHub в рамках выполнения команд.

## Определения и сущности

### Авторизация GitHub

**Авторизация** — процесс входа в ваш GitHub аккаунт через систему `tg`. После успешной авторизации ваши данные сохраняются локально и используются для доступа к GitHub при выполнении команд.

### Плагин login

**login** — плагин с командами для управления авторизацией GitHub. Предоставляет интерфейс для входа и выхода из GitHub аккаунта.

### Плагин auth-github

**auth-github** — плагин, который выполняется автоматически перед каждой командой (кроме команды `login`). Плагин требует наличия активной авторизации GitHub и предоставляет данные вашего аккаунта другим командам.

**Важно:** Плагин `auth-github` требует обязательной авторизации. При отсутствии авторизации плагин возвращает ошибку с требованием выполнить `tg login`.

## Установка

### Добавление каталога плагинов

Перед установкой плагинов необходимо добавить каталог (источник плагинов):

```bash
# Добавить каталог
tg pkg repo https://github.com/seniorGolang/tgp-auth
```

### Обновление каталогов

После добавления каталога обновите его:

```bash
# Обновить все каталоги
tg pkg update
```

### Установка плагинов

После обновления каталога плагины доступны для установки. Установите плагины из каталога.

## Использование

### Последовательность работы

#### 1. Авторизация

Перед использованием любых команд, требующих доступ к GitHub, необходимо выполнить авторизацию:

```bash
tg login
```

**Процесс авторизации:**

1. Отображается URL для авторизации и код подтверждения
2. Вы можете выбрать: открыть браузер автоматически или скопировать URL вручную
3. В браузере авторизуйте приложение, используя код подтверждения
4. После успешной авторизации ваши данные сохраняются локально

**Результат:** Авторизация завершена. Теперь вы можете использовать команды, требующие доступ к GitHub.

#### 2. Выполнение команд

После успешной авторизации плагин `auth-github` автоматически выполняется перед каждой командой (кроме `login`):

- Плагин проверяет наличие активной авторизации
- При необходимости автоматически обновляет авторизацию
- Получает данные вашего аккаунта GitHub
- Предоставляет эти данные другим командам

**Если авторизация отсутствует или истекла:**

- Плагин `auth-github` возвращает ошибку: `"login required via tg login"`
- Выполнение команды прерывается
- Необходимо выполнить `tg login` для повторной авторизации

#### 3. Выход из GitHub

Для завершения авторизованной сессии и удаления сохранённых данных:

```bash
tg logout
```

**Результат:** Авторизация завершена, данные удалены. При следующем выполнении команды потребуется повторная авторизация через `tg login`.

## Логика работы плагинов

### Взаимодействие плагинов

1. **Плагин login** — управляет авторизацией:

   - Создание авторизации через браузер
   - Сохранение данных авторизации локально
   - Удаление данных при выходе

2. **Плагин auth-github** — обеспечивает авторизованный доступ:
   - Выполняется автоматически перед каждой командой
   - Пропускает проверку только для команды `login`
   - Требует обязательной авторизации для всех остальных команд
   - Автоматически обновляет авторизацию при истечении
   - Предоставляет данные аккаунта другим командам

### Обработка ошибок

**Отсутствие авторизации:**

- Плагин `auth-github` возвращает ошибку: `"login required via tg login"`
- Выполнение команды прерывается

**Истекшая авторизация:**

- Плагин пытается автоматически обновить авторизацию
- При успешном обновлении выполнение продолжается
- При неудачном обновлении возвращается ошибка: `"login required via tg login"`
- Требуется повторная авторизация через `tg login`

## Требования

- Установленная система `tg`
- Аккаунт на GitHub
- Браузер для авторизации (для команды `tg login`)

## Безопасность

- Данные авторизации сохраняются локально в защищённом хранилище
- Плагины работают в изолированной среде
- Доступ к GitHub осуществляется только через официальные сервисы
- Авторизацию можно завершить в любой момент через `tg logout`
- Автоматическое обновление авторизации происходит без участия пользователя

## Лицензия

MIT

## Автор

AlexK <seniorGolang@gmail.com>
